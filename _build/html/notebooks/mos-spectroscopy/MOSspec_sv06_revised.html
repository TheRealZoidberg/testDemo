<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   MOS Spectroscopy of Typical Extragalactic Field — STScI JDAT Notebooks
  </title>
  <link href="../../_static/css/theme.css" rel="stylesheet"/>
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet"/>
  <link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
  <link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" rel="stylesheet" type="text/css"/>
  <link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/main.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" rel="stylesheet" type="text/css"/>
  <link as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js" rel="preload"/>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js">
  </script>
  <script src="../../_static/jquery.js">
  </script>
  <script src="../../_static/underscore.js">
  </script>
  <script src="../../_static/doctools.js">
  </script>
  <script src="../../_static/clipboard.min.js">
  </script>
  <script src="../../_static/copybutton.js">
  </script>
  <script>
   let toggleHintShow = 'Click to show';
  </script>
  <script>
   let toggleHintHide = 'Click to hide';
  </script>
  <script>
   let toggleOpenOnPrint = 'true';
  </script>
  <script src="../../_static/togglebutton.js">
  </script>
  <script>
   var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';
  </script>
  <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js">
  </script>
  <script>
   const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
  </script>
  <script async="async" src="../../_static/sphinx-thebe.js">
  </script>
  <link href="../../genindex.html" rel="index" title="Index"/>
  <link href="../../search.html" rel="search" title="Search"/>
  <link href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html" rel="next" title="Extracting an Exoplanet Transmission Spectrum from NIRSpec BOTS Time Series Observations"/>
  <link href="../ifu_optimal/ifu_optimal.html" rel="prev" title="Baseline: NIRSpec IFU Optimal Point Source Extraction"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="None" name="docsearch:language"/>
  <!-- Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
  </script>
 </head>
 <body data-offset="80" data-spy="scroll" data-target="#bd-toc-nav">
  <div class="container-fluid" id="banner">
  </div>
  <div class="container-xl">
   <div class="row">
    <div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
     <div class="navbar-brand-box">
      <a class="navbar-brand text-wrap" href="../../index.html">
       <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
       <img alt="logo" class="logo" src="../../_static/stsci_logo2.png"/>
       <h1 class="site-logo" id="site-title">
        STScI JDAT Notebooks
       </h1>
      </a>
     </div>
     <form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
      <i class="icon fas fa-search">
      </i>
      <input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
     </form>
     <nav aria-label="Main" class="bd-links" id="bd-docs-nav">
      <div class="bd-toc-item active">
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../../intro.html">
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         Cross-Instrument
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../asdf_example/asdf_example.html">
          Example of Converting a FITS File to ASDF
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../background_estimation_imaging/Imaging%20Sky%20Background%20Estimation.html">
          Complex 2D Background
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
          Draft: Advanced Composite spectral model fitting
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
          MAST Query
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
          Specviz Simple Demo
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         MIRI
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html">
          MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">
          Data Analysis
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
          JWST Data Analysis
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
          LRS Extraction
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRCam
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
          Point Source Aperture Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRCam_photometry/NIRCam%20multiband%20photometry.html">
          NIRCam Multiband Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
          PSF Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
          NIRCam PSF-matched multiband photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../preimaging/preimaging_02_calwebb.html">
          Preimaging - Calwebb
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../preimaging/preimaging_03_association.html">
          Creating simulated images of the JWST astrometric calibration field in the LMC
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRISS
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00.%20Optimal%20extraction.html">
          Part 0: Optimal Extraction of NIRISS WFSS Spectrum
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01.%20Combine%20and%20normalize%201D%20spectra.html">
          Part 1: Combine One-Dimensional NIRISS WFSS Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02.%20Cross%20correlation%20template.html">
          Part 2: Cross Correlation to Determine Redshift of NIRISS WFSS Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html">
          Part 3: Spatially Resolved Emission Line Map of NIRISS WFSS Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../niriss_ami_binary/1_niriss_ami_binary.html">
          NIRISS AMI simulation of binary point source AB Dor and calibrator HD37093
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../niriss_ami_binary/2_niriss_ami_binary.html">
          AMI Binary Star Notebook 2
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../soss-transit-spectroscopy/HAT-P-1b-PART3-data-analysis.html">
          SOSS Transient Spectroscopy
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRSpec
        </span>
       </p>
       <ul class="current nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
          MOS Optimal Extraction
         </a>
        </li>
        <li class="toctree-l1 current active">
         <a class="current reference internal" href="#">
          MOS Spectroscopy of Extragalactic Field
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
          Extracting an Exoplanet Transmission Spectrum from NIRSpec BOTS Time Series Observations
         </a>
        </li>
       </ul>
      </div>
     </nav>
     <!-- To handle the deprecated key -->
     <div class="navbar_extra_footer">
      Powered by
      <a href="https://jupyterbook.org">
       Jupyter Book
      </a>
     </div>
    </div>
    <main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
     <div class="topbar container-xl fixed-top">
      <div class="topbar-contents row">
       <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
       </div>
       <div class="col pl-md-4 topbar-main">
        <button aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" class="navbar-toggler ml-0" data-placement="bottom" data-target=".site-navigation" data-toggle="collapse" id="navbar-toggler" title="Toggle navigation" type="button">
         <i class="fas fa-bars">
         </i>
         <i class="fas fa-arrow-left">
         </i>
         <i class="fas fa-arrow-up">
         </i>
        </button>
        <div class="dropdown-buttons-trigger">
         <button aria-label="Download this page" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fas fa-download">
          </i>
         </button>
         <div class="dropdown-buttons">
          <!-- ipynb file if we had a myst markdown file -->
          <!-- Download raw file -->
          <a class="dropdown-buttons" href="../../_sources/notebooks/mos-spectroscopy/MOSspec_sv06_revised.ipynb">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Download source file" type="button">
            .ipynb
           </button>
          </a>
          <!-- Download PDF via print -->
          <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" id="download-print" onclick="printPdf(this)" title="Print to PDF" type="button">
           .pdf
          </button>
         </div>
        </div>
        <!-- Source interaction buttons -->
        <div class="dropdown-buttons-trigger">
         <button aria-label="Connect with source repository" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fab fa-github">
          </i>
         </button>
         <div class="dropdown-buttons sourcebuttons">
          <a class="repository-button" href="https://github.com/spacetelescope/jdat_notebooks/">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Source repository" type="button">
            <i class="fab fa-github">
            </i>
            repository
           </button>
          </a>
          <a class="issues-button" href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/mos-spectroscopy/MOSspec_sv06_revised.html&amp;body=Your%20issue%20content%20here.">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Open an issue" type="button">
            <i class="fas fa-lightbulb">
            </i>
            open issue
           </button>
          </a>
         </div>
        </div>
        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button">
         <button aria-label="Fullscreen mode" class="btn btn-secondary topbarbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode" type="button">
          <i class="fas fa-expand">
          </i>
         </button>
        </a>
        <!-- Launch buttons -->
        <div class="dropdown-buttons-trigger">
         <button aria-label="Launch interactive content" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fas fa-rocket">
          </i>
         </button>
         <div class="dropdown-buttons">
          <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" onclick="initThebeSBT()" title="Launch Thebe" type="button">
           <i class="fas fa-play">
           </i>
           <span style="margin-left: .4em;">
            Live Code
           </span>
          </button>
         </div>
        </div>
       </div>
       <!-- Table of contents -->
       <div class="d-none d-md-block col-md-2 bd-toc show noprint">
        <div class="tocsection onthispage pt-5 pb-3">
         <i class="fas fa-list">
         </i>
         Contents
        </div>
        <nav aria-label="Page" id="bd-toc-nav">
         <ul class="visible nav section-nav flex-column">
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#introduction">
            Introduction
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#imports">
            Imports
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#check-versions-should-be">
            Check versions. Should be:
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#set-path-to-data-and-download-from-box-link">
            Set path to data and download from box link
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#choose-one-galaxy">
            Choose one galaxy
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#inspect-its-2d-spectrum">
            Inspect its 2D spectrum
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#developer-note">
              Developer note
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#now-work-with-1d-spectrum">
            Now work with 1D spectrum
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#calibrate-in-wavelength-inspect-and-write-in-spectrum1d-object">
            Calibrate (in wavelength), inspect, and write in Spectrum1D object
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#go-with-specutils">
            Go with specutils
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#id1">
              Developer note
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#id2">
              Developer note
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#smooth-to-better-inspect-the-features">
            Smooth to better inspect the features
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#id3">
              Developer note
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#back-to-the-non-smoothed-spectrum-to-find-lines">
            Back to the non-smoothed spectrum to find lines
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#so-fit-continuum-first">
            So fit continuum first
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#creating-the-continuum-subtracted-spectrum">
              Creating the continuum-subtracted spectrum
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#now-look-for-the-lines">
            Now look for the lines
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#works-better-with-find-lines-threshold">
              Works better with find_lines_threshold
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h4 nav-item toc-entry">
               <a class="reference internal nav-link" href="#id4">
                Developer note
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#measure-line-centroids-and-fluxes">
            Measure line centroids and fluxes
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#fit-the-line-with-a-gaussian">
            Fit the line with a Gaussian
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#id5">
              Developer note
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#measure-the-equivalent-width-of-the-lines">
            Measure the equivalent width of the lines
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#find-the-best-fitting-template">
            Find the best-fitting template
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#id6">
              Developer note
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#potential-next-steps">
            Potential next steps:
           </a>
          </li>
         </ul>
        </nav>
       </div>
      </div>
     </div>
     <div class="row" id="main-content">
      <div class="col-12 col-md-9 pl-md-3 pr-md-0">
       <!-- Table of contents that is only displayed when printing the page -->
       <div class="onlyprint" id="jb-print-docs-body">
        <h1>
         MOS Spectroscopy of Typical Extragalactic Field
        </h1>
        <!-- Table of contents -->
        <div id="print-main-content">
         <div id="jb-print-toc">
          <div>
           <h2>
            Contents
           </h2>
          </div>
          <nav aria-label="Page">
           <ul class="visible nav section-nav flex-column">
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#introduction">
              Introduction
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#imports">
              Imports
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#check-versions-should-be">
              Check versions. Should be:
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#set-path-to-data-and-download-from-box-link">
              Set path to data and download from box link
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#choose-one-galaxy">
              Choose one galaxy
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#inspect-its-2d-spectrum">
              Inspect its 2D spectrum
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#developer-note">
                Developer note
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#now-work-with-1d-spectrum">
              Now work with 1D spectrum
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#calibrate-in-wavelength-inspect-and-write-in-spectrum1d-object">
              Calibrate (in wavelength), inspect, and write in Spectrum1D object
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#go-with-specutils">
              Go with specutils
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#id1">
                Developer note
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#id2">
                Developer note
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#smooth-to-better-inspect-the-features">
              Smooth to better inspect the features
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#id3">
                Developer note
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#back-to-the-non-smoothed-spectrum-to-find-lines">
              Back to the non-smoothed spectrum to find lines
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#so-fit-continuum-first">
              So fit continuum first
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#creating-the-continuum-subtracted-spectrum">
                Creating the continuum-subtracted spectrum
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#now-look-for-the-lines">
              Now look for the lines
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#works-better-with-find-lines-threshold">
                Works better with find_lines_threshold
               </a>
               <ul class="nav section-nav flex-column">
                <li class="toc-h4 nav-item toc-entry">
                 <a class="reference internal nav-link" href="#id4">
                  Developer note
                 </a>
                </li>
               </ul>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#measure-line-centroids-and-fluxes">
              Measure line centroids and fluxes
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#fit-the-line-with-a-gaussian">
              Fit the line with a Gaussian
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#id5">
                Developer note
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#measure-the-equivalent-width-of-the-lines">
              Measure the equivalent width of the lines
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#find-the-best-fitting-template">
              Find the best-fitting template
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#id6">
                Developer note
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#potential-next-steps">
              Potential next steps:
             </a>
            </li>
           </ul>
          </nav>
         </div>
        </div>
       </div>
       <div>
        <div class="tex2jax_ignore mathjax_ignore section" id="mos-spectroscopy-of-typical-extragalactic-field">
         <h1>
          MOS Spectroscopy of Typical Extragalactic Field
          <a class="headerlink" href="#mos-spectroscopy-of-typical-extragalactic-field" title="Permalink to this headline">
           ¶
          </a>
         </h1>
         <p>
          <strong>
           Use case:
          </strong>
          emission-line measurements and template matching on 1D spectra.
          <br/>
          <strong>
           Data:
          </strong>
          <a class="reference external" href="https://www2.mpia-hd.mpg.de/home/legac/">
           LEGA-C
          </a>
          spectra and galaxy template spectra; optical rest-frame.
          <br/>
          <strong>
           Tools:
          </strong>
          specutils, astropy, matplotlib, pandas.
          <br/>
          <strong>
           Cross-intrument:
          </strong>
          NIRSpec
          <br/>
          <strong>
           Documentation:
          </strong>
          This notebook is part of a STScI’s larger
          <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">
           post-pipeline Data Analysis Tools Ecosystem
          </a>
          .
          <br/>
         </p>
         <div class="section" id="introduction">
          <h2>
           Introduction
           <a class="headerlink" href="#introduction" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           This notebook will perform a seris of spectroscopic analyses on multiple spectra, including smoothing, continuum fitting and subtraction, line identification, centroiding and flux measurements, gaussian fitting, equivalent widths, and template fitting.
          </p>
          <p>
           <strong>
            Note:
           </strong>
           This notebook is intended to ultimately be compatible with the final data products (1D and 2D spectra) from the JWST pipeline. These data products are not available yet, so the notebook uses LEGA-C data (van der Wel et al. 2016, Straatmann et al. 2018) for now.
          </p>
          <p>
           LEGA-C is a galaxy survey of about 3000 galaxies at z~0.8 and M* &gt; 10^10 M_sun in the COSMOS field. The spectra sample the rest-frame optical between ~3000A and 5000A at high resolution and very high signal-to-noise ratio. More information about the survey can be found here:
           <a class="reference external" href="http://www.mpia.de/home/legac/">
            http://www.mpia.de/home/legac/
           </a>
          </p>
          <p>
           First, set the environment with astroconda and specutils.
          </p>
          <p>
           <code class="docutils literal notranslate">
            <span class="pre">
             conda
            </span>
            <span class="pre">
             create
            </span>
            <span class="pre">
             -n
            </span>
            <span class="pre">
             astroutils
            </span>
            <span class="pre">
             stsci
            </span>
           </code>
          </p>
          <p>
           <code class="docutils literal notranslate">
            <span class="pre">
             source
            </span>
            <span class="pre">
             activate
            </span>
            <span class="pre">
             astroutils
            </span>
           </code>
          </p>
         </div>
         <div class="section" id="imports">
          <h2>
           Imports
           <a class="headerlink" href="#imports" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1">#general os</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="c1">#general plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">'legend.fontsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span><span class="s1">'axes.labelsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span>
        <span class="s1">'axes.titlesize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span><span class="s1">'xtick.labelsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span>
        <span class="s1">'ytick.labelsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span><span class="s1">'lines.linewidth'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">'axes.linewidth'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">'animation.html'</span><span class="p">:</span> <span class="s1">'html5'</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'figure.max_open_warning'</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="c1">#table/math handling</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s1">'ignore'</span><span class="p">)</span>  <span class="c1"># hides irrelevant warnings about divide-by-zero, etc</span>

<span class="c1">#astropy</span>
<span class="kn">import</span> <span class="nn">astropy</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">QTable</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span><span class="p">,</span><span class="n">ascii</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">StdDevUncertainty</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">quantity_support</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>

<span class="c1">#specutils</span>
<span class="kn">import</span> <span class="nn">specutils</span>
<span class="kn">from</span> <span class="nn">specutils</span> <span class="kn">import</span> <span class="n">Spectrum1D</span><span class="p">,</span> <span class="n">SpectralRegion</span>
<span class="kn">from</span> <span class="nn">specutils.manipulation</span> <span class="kn">import</span> <span class="n">gaussian_smooth</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">fit_generic_continuum</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">find_lines_derivative</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">find_lines_threshold</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">fit_lines</span>
<span class="kn">from</span> <span class="nn">specutils.manipulation</span> <span class="kn">import</span> <span class="n">noise_region_uncertainty</span>
<span class="kn">from</span> <span class="nn">specutils.analysis</span> <span class="kn">import</span> <span class="n">centroid</span>
<span class="kn">from</span> <span class="nn">specutils.analysis</span> <span class="kn">import</span> <span class="n">line_flux</span>
<span class="kn">from</span> <span class="nn">specutils.analysis</span> <span class="kn">import</span> <span class="n">equivalent_width</span>
<span class="kn">from</span> <span class="nn">specutils.analysis</span> <span class="kn">import</span> <span class="n">template_comparison</span>

<span class="n">quantity_support</span><span class="p">();</span>  <span class="c1"># auto-recognizes units on matplotlib plots</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="check-versions-should-be">
          <h2>
           Check versions. Should be:
           <a class="headerlink" href="#check-versions-should-be" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Pandas:  1.0.1
          </p>
          <p>
           Numpy:  1.18.1
          </p>
          <p>
           Astropy:  4.0
          </p>
          <p>
           Specutils:  0.7
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Pandas: "</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Numpy: "</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Astropy: "</span><span class="p">,</span><span class="n">astropy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Specutils: "</span><span class="p">,</span><span class="n">specutils</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="set-path-to-data-and-download-from-box-link">
          <h2>
           Set path to data and download from box link
           <a class="headerlink" href="#set-path-to-data-and-download-from-box-link" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">boxlink</span> <span class="o">=</span> <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/mos_spectroscopy/mos_spectroscopy.zip'</span>
<span class="n">boxfile</span> <span class="o">=</span> <span class="s1">'./mos_spectroscopy.zip'</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>

<span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">boxfile</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>
<span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>

<span class="n">observedfiles</span> <span class="o">=</span> <span class="s1">'./mos_spectroscopy/observed/'</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="choose-one-galaxy">
          <h2>
           Choose one galaxy
           <a class="headerlink" href="#choose-one-galaxy" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">file1d</span> <span class="o">=</span> <span class="n">observedfiles</span> <span class="o">+</span> <span class="s1">'legac_M1_v3.7_spec1d_130902.fits'</span>
<span class="n">file1dwht</span> <span class="o">=</span> <span class="n">observedfiles</span> <span class="o">+</span> <span class="s1">'legac_M1_v3.7_wht1d_130902.fits'</span>
<span class="n">file2d</span> <span class="o">=</span> <span class="n">observedfiles</span> <span class="o">+</span> <span class="s1">'legac_M1_v3.7_spec2d_130902.fits'</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="inspect-its-2d-spectrum">
          <h2>
           Inspect its 2D spectrum
           <a class="headerlink" href="#inspect-its-2d-spectrum" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">hdu2d</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file2d</span><span class="p">)</span>
<span class="n">hdu2d</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">hdu2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="developer-note">
           <h3>
            Developer note
            <a class="headerlink" href="#developer-note" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            I would appreciate the interactive tools here to zoom and pan through the 2D spectrum. Hoovering to know the precise wavelength of a feature would also be very useful. With that, the interactive tool could show automatically the calibration in wavelength reading it from the header.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdu2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">3000</span><span class="p">)</span> <span class="c1">#spec is very big, plot just a bit</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="now-work-with-1d-spectrum">
          <h2>
           Now work with 1D spectrum
           <a class="headerlink" href="#now-work-with-1d-spectrum" title="Permalink to this headline">
            ¶
           </a>
          </h2>
         </div>
         <div class="section" id="calibrate-in-wavelength-inspect-and-write-in-spectrum1d-object">
          <h2>
           Calibrate (in wavelength), inspect, and write in Spectrum1D object
           <a class="headerlink" href="#calibrate-in-wavelength-inspect-and-write-in-spectrum1d-object" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">hdu1d</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file1d</span><span class="p">)</span>
<span class="n">hdu1dwht</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file1dwht</span><span class="p">)</span>
<span class="n">hdu1d</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">hdu1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           If i want to do it in Pandas.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">flux</span> <span class="o">=</span> <span class="n">hdu1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>
<span class="n">wht</span> <span class="o">=</span> <span class="n">hdu1dwht</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>
<span class="n">unc</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">wht</span><span class="p">)</span>
<span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">flux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">hdu1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'CD1_1'</span><span class="p">]</span> <span class="o">+</span> <span class="n">hdu1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'CRVAL1'</span><span class="p">]</span>

<span class="c1">##for certain functions, I need to cut the spectrum where the weight is 0.</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'wavelength'</span><span class="p">:</span><span class="n">wave</span><span class="p">,</span> <span class="s1">'flux'</span><span class="p">:</span><span class="n">flux</span><span class="p">,</span> <span class="s1">'weight'</span><span class="p">:</span><span class="n">wht</span><span class="p">,</span> <span class="s1">'uncertainty'</span><span class="p">:</span><span class="n">unc</span><span class="p">}</span>
<span class="n">dataspec</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>

<span class="c1">##define subset where wht&gt;0</span>
<span class="n">dataspec_sub</span> <span class="o">=</span> <span class="n">dataspec</span><span class="p">[</span><span class="n">dataspec</span><span class="p">[</span><span class="s1">'weight'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataspec_sub</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           If I want to do it in astropy Tables.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">flux</span> <span class="o">=</span> <span class="n">hdu1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">wht</span> <span class="o">=</span> <span class="n">hdu1dwht</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">unc</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">wht</span><span class="p">)</span>
<span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">flux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">hdu1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'CD1_1'</span><span class="p">]</span> <span class="o">+</span> <span class="n">hdu1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'CRVAL1'</span><span class="p">]</span>

<span class="n">spec_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">'10^-19 erg s^-1 cm^-2 angstrom^-1'</span><span class="p">)</span>
<span class="n">dataspec</span> <span class="o">=</span> <span class="n">QTable</span><span class="p">([</span><span class="n">wave</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="p">,</span> <span class="n">flux</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">wht</span><span class="p">,</span> <span class="n">unc</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">],</span> 
                   <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">'wavelength'</span><span class="p">,</span><span class="s1">'flux'</span><span class="p">,</span><span class="s1">'weight'</span><span class="p">,</span><span class="s1">'uncertainty'</span><span class="p">))</span>
<span class="n">dataspec_sub</span> <span class="o">=</span> <span class="n">dataspec</span><span class="p">[</span><span class="n">dataspec</span><span class="p">[</span><span class="s1">'weight'</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">]</span>
<span class="n">dataspec_sub</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'wavelength'</span><span class="p">],</span>
                 <span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'flux'</span><span class="p">]</span><span class="o">+</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'uncertainty'</span><span class="p">],</span>
                 <span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'flux'</span><span class="p">]</span><span class="o">-</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'uncertainty'</span><span class="p">],</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">"uncertainty"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'wavelength'</span><span class="p">],</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'flux'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'wavelength'</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'flux'</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Observed spectrum"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="go-with-specutils">
          <h2>
           Go with specutils
           <a class="headerlink" href="#go-with-specutils" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1">#write Spectrum1D object</span>
<span class="n">spec1d</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'wavelength'</span><span class="p">],</span> 
                    <span class="n">flux</span><span class="o">=</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'flux'</span><span class="p">],</span> 
                    <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">(</span><span class="n">dataspec_sub</span><span class="p">[</span><span class="s1">'uncertainty'</span><span class="p">]))</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="id1">
           <h3>
            Developer note
            <a class="headerlink" href="#id1" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            For supported datasets (like final JWST data products), this will be as simple as:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">spec1d</span> <span class="o">=</span> <span class="n">Spectrum1d</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'datafile.fits'</span><span class="p">)</span>
</pre>
            </div>
           </div>
          </div>
          <div class="section" id="id2">
           <h3>
            Developer note
            <a class="headerlink" href="#id2" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Implemented but not yet released:
            <code class="docutils literal notranslate">
             <span class="pre">
              snr_threshold
             </span>
            </code>
            , which will allow cutting the spectrum using that function.
           </p>
          </div>
         </div>
         <div class="section" id="smooth-to-better-inspect-the-features">
          <h2>
           Smooth to better inspect the features
           <a class="headerlink" href="#smooth-to-better-inspect-the-features" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="section" id="id3">
           <h3>
            Developer note
            <a class="headerlink" href="#id3" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            The uncertainty is not carried over, but would be useful. Same comment on the interactive tool as before: it would be very useful to be able to zoom, pan, hoover, etc. on the spectrum.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">spec1d_gsmooth</span> <span class="o">=</span> <span class="n">gaussian_smooth</span><span class="p">(</span><span class="n">spec1d</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_gsmooth</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_gsmooth</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_gsmooth</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_gsmooth</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Smoothed observed spectrum"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="back-to-the-non-smoothed-spectrum-to-find-lines">
          <h2>
           Back to the non-smoothed spectrum to find lines
           <a class="headerlink" href="#back-to-the-non-smoothed-spectrum-to-find-lines" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Documentation says I need a continuum subtracted spectrum.
          </p>
         </div>
         <div class="section" id="so-fit-continuum-first">
          <h2>
           So fit continuum first
           <a class="headerlink" href="#so-fit-continuum-first" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">cont_spec1d</span> <span class="o">=</span> <span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">spec1d</span><span class="p">)</span>
<span class="n">cont_fit</span> <span class="o">=</span> <span class="n">cont_spec1d</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec1d</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">cont_fit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"modeled continuum"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Observed spectrum and fitted continuum"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec1d</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"uncertainty ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Uncertianty of observed spectrum"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="creating-the-continuum-subtracted-spectrum">
           <h3>
            Creating the continuum-subtracted spectrum
            <a class="headerlink" href="#creating-the-continuum-subtracted-spectrum" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Specutils will figure out what to do with the uncertainty!
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">spec1d_sub</span> <span class="o">=</span> <span class="n">spec1d</span> <span class="o">-</span> <span class="n">cont_fit</span>
<span class="n">spec1d_sub</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Continuum-subracted spectrum"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"uncertainty ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Uncertainty of continuum-subracted spectrum"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="now-look-for-the-lines">
          <h2>
           Now look for the lines
           <a class="headerlink" href="#now-look-for-the-lines" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="n">find_lines_derivative</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="p">,</span> <span class="n">flux_threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">lines</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="s1">'line_center'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'emission/absorption lines'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">'line_center'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Continuum-subtracted spectrum and marked lines using find_lines_derivative"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           This works for cases where you understand the thresholds well, but doesn’t automate as well with noisy spectra.
          </p>
          <div class="section" id="works-better-with-find-lines-threshold">
           <h3>
            Works better with find_lines_threshold
            <a class="headerlink" href="#works-better-with-find-lines-threshold" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="n">find_lines_threshold</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="p">,</span> <span class="n">noise_factor</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">lines</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <p>
            Plot lines on the spectrum.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="s1">'line_center'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'emission/absorption lines'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">'line_center'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Continuum-subtracted spectrum and marked lines using find_lines_threshold"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="section" id="id4">
            <h4>
             Developer note
             <a class="headerlink" href="#id4" title="Permalink to this headline">
              ¶
             </a>
            </h4>
            <p>
             It would be useful to have a tool to cycle through the lines, show a zoom of the spectrum, and inspect how good the line identification is. For now I do it by hand on a single line.
            </p>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="s1">'line_center'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'[OII]'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">'line_center'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">6500</span><span class="p">,</span><span class="mi">6600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Continuum-subtracted spectrum zoomed on [OII]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="measure-line-centroids-and-fluxes">
          <h2>
           Measure line centroids and fluxes
           <a class="headerlink" href="#measure-line-centroids-and-fluxes" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           These too need spectra continuum subtracted.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1">#example with just one line</span>
<span class="n">centroid</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="p">,</span> <span class="n">SpectralRegion</span><span class="p">(</span><span class="mi">6540</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="mi">6580</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">))</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">sline</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="p">,</span> <span class="n">SpectralRegion</span><span class="p">(</span><span class="mi">6540</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="mi">6580</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">sline</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"[OII]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'flux = 0'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">6500</span><span class="p">,</span><span class="mi">6600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Continuum-subtracted spectrum zoomed on [OII]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">line_flux</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="p">,</span> <span class="n">SpectralRegion</span><span class="p">(</span><span class="mi">6540</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="mi">6570</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">))</span>  
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="fit-the-line-with-a-gaussian">
          <h2>
           Fit the line with a Gaussian
           <a class="headerlink" href="#fit-the-line-with-a-gaussian" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="section" id="id5">
           <h3>
            Developer note
            <a class="headerlink" href="#id5" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Fitting lines with Gaussians is so common that it might make sense to have a one-line to iterate this over the list of lines, with sensible initialization of parameters and fit ranges for each line so that the fits generally work.
           </p>
           <p>
            Also, the interactive tool here could allow one to select the continuum region and position of the line by clicking on the spectrum.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">g_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">1e-19</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">6554</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
<span class="n">g_fit</span> <span class="o">=</span> <span class="n">fit_lines</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="p">,</span> <span class="n">g_init</span><span class="p">)</span>
<span class="n">spec1d_fit</span> <span class="o">=</span> <span class="n">g_fit</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
<span class="n">g_fit</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1">#calculate the velocity dispertion from the stddev</span>
<span class="n">vel</span> <span class="o">=</span> <span class="p">((</span><span class="mf">3.71890256</span><span class="o">/</span><span class="mf">6554.415</span><span class="p">)</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span><span class="n">spec1d_fit</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Gaussian fit'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">6500</span><span class="p">,</span><span class="mi">6600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Gaussian fit to the [OII] line'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="measure-the-equivalent-width-of-the-lines">
          <h2>
           Measure the equivalent width of the lines
           <a class="headerlink" href="#measure-the-equivalent-width-of-the-lines" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           This needs the spectrum continuum normalized.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">spec1d_norm</span> <span class="o">=</span> <span class="n">spec1d</span> <span class="o">/</span> <span class="n">cont_fit</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_norm</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec1d_norm</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'flux = 1'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_norm</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux (normalized)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">6500</span><span class="p">,</span><span class="mi">6600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Continuum-normalized spectrum, zoomed on [OII]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_norm</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec1d_norm</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_norm</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"uncertainty (normalized)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">6500</span><span class="p">,</span><span class="mi">6600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Uncertainty of continuum-normalized spectrum, zoomed on [OII]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">equivalent_width</span><span class="p">(</span><span class="n">spec1d_norm</span><span class="p">,</span> <span class="n">regions</span><span class="o">=</span><span class="n">SpectralRegion</span><span class="p">(</span><span class="mi">6540</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="mi">6570</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">))</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="find-the-best-fitting-template">
          <h2>
           Find the best-fitting template
           <a class="headerlink" href="#find-the-best-fitting-template" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           It needs a list of templates and the redshift of the observed galaxy. For the templates, I am using a set of model SEDs generated with Bruzual &amp; Charlot stellar population models, emission lines, and dust attenuation as described in Pacifici et al. (2012).
          </p>
          <div class="section" id="id6">
           <h3>
            Developer note
            <a class="headerlink" href="#id6" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Maybe there is a way to speed this up (maybe using astropy model_sets)? This fit is run with 100 models, but ideally, if we want to extract physical parameters from this, we would need at least 10,000 models.
           </p>
           <p>
            A dictionary structure with meaningful keys (which can be, e.g., tuples of the relevant physical parameters) could be better than a list? It could make later analysis much clearer than having to map from the list indices back to the relevant parameters.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">templatedir</span> <span class="o">=</span> <span class="s1">'./mos_spectroscopy/templates/'</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">zz</span> <span class="o">=</span> <span class="mf">0.758</span>

<span class="n">templatelist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">):</span>
    <span class="n">template_file</span> <span class="o">=</span> <span class="s2">"</span><span class="si">{0}{1:05d}</span><span class="s2">.dat"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">templatedir</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">template_file</span><span class="p">)</span>
    <span class="n">temp1d</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">template</span><span class="p">[</span><span class="s1">'col1'</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span><span class="n">flux</span><span class="o">=</span><span class="n">template</span><span class="p">[</span><span class="s1">'col2'</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
    <span class="n">templatelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp1d</span><span class="p">)</span>
    
    
<span class="n">tm_results</span> <span class="o">=</span> <span class="n">template_comparison</span><span class="o">.</span><span class="n">template_match</span><span class="p">(</span><span class="n">observed_spectrum</span><span class="o">=</span><span class="n">spec1d</span><span class="p">,</span> <span class="n">spectral_templates</span><span class="o">=</span><span class="n">templatelist</span><span class="p">,</span> <span class="n">resample_method</span><span class="o">=</span><span class="s2">"flux_conserving"</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="n">zz</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">tm_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">spec1d</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"data"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tm_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">tm_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'model'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">6000</span><span class="p">,</span> <span class="mi">9000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_norm</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_sub</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Observed spectrum and best-fitting model template"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="potential-next-steps">
          <h2>
           Potential next steps:
           <a class="headerlink" href="#potential-next-steps" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="highlight-none notranslate">
           <div class="highlight">
            <pre><span></span>- Automatic template *fitting* to get the redshift
- Measure if emission-line profile is consistent with PSF
- Measure line intensities in 2D
- Convert distances from pixels to kpc
- Run the line measurements on a set of lines
- Run the whole procedure on all galaxies detected on a mask
</pre>
           </div>
          </div>
         </div>
        </div>
        <script type="text/x-thebe-config">
         {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/mos-spectroscopy"
        },
        predefinedOutput: true
    }
        </script>
        <script>
         kernelName = 'python3'
        </script>
       </div>
       <!-- Previous / next buttons -->
       <div class="prev-next-area">
        <a class="left-prev" href="../ifu_optimal/ifu_optimal.html" id="prev-link" title="previous page">
         <i class="fas fa-angle-left">
         </i>
         <div class="prev-next-info">
          <p class="prev-next-subtitle">
           previous
          </p>
          <p class="prev-next-title">
           Baseline: NIRSpec IFU Optimal Point Source Extraction
          </p>
         </div>
        </a>
        <a class="right-next" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html" id="next-link" title="next page">
         <div class="prev-next-info">
          <p class="prev-next-subtitle">
           next
          </p>
          <p class="prev-next-title">
           Extracting an Exoplanet Transmission Spectrum from NIRSpec BOTS Time Series Observations
          </p>
         </div>
         <i class="fas fa-angle-right">
         </i>
        </a>
       </div>
      </div>
     </div>
     <footer class="footer">
      <p>
       By STScI
       <br/>
       © Copyright 2022.
       <br/>
      </p>
     </footer>
    </main>
   </div>
  </div>
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js">
  </script>
 </body>
</html>

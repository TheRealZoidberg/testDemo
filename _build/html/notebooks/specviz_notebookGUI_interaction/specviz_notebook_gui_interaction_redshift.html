<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Specviz notebook/GUI interaction on NIRISS WFSS 1D spectra — STScI JDAT Notebooks
  </title>
  <link href="../../_static/css/theme.css" rel="stylesheet"/>
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet"/>
  <link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
  <link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" rel="stylesheet" type="text/css"/>
  <link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/main.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" rel="stylesheet" type="text/css"/>
  <link as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js" rel="preload"/>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js">
  </script>
  <script src="../../_static/jquery.js">
  </script>
  <script src="../../_static/underscore.js">
  </script>
  <script src="../../_static/doctools.js">
  </script>
  <script src="../../_static/clipboard.min.js">
  </script>
  <script src="../../_static/copybutton.js">
  </script>
  <script>
   let toggleHintShow = 'Click to show';
  </script>
  <script>
   let toggleHintHide = 'Click to hide';
  </script>
  <script>
   let toggleOpenOnPrint = 'true';
  </script>
  <script src="../../_static/togglebutton.js">
  </script>
  <script>
   var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';
  </script>
  <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js">
  </script>
  <script>
   const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
  </script>
  <script async="async" src="../../_static/sphinx-thebe.js">
  </script>
  <link href="../../genindex.html" rel="index" title="Index"/>
  <link href="../../search.html" rel="search" title="Search"/>
  <link href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html" rel="next" title="MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline"/>
  <link href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html" rel="prev" title="MAST Query Tutorial for NIRSpec Users"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="None" name="docsearch:language"/>
  <!-- Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
  </script>
 </head>
 <body data-offset="80" data-spy="scroll" data-target="#bd-toc-nav">
  <div class="container-fluid" id="banner">
  </div>
  <div class="container-xl">
   <div class="row">
    <div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
     <div class="navbar-brand-box">
      <a class="navbar-brand text-wrap" href="../../index.html">
       <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
       <img alt="logo" class="logo" src="../../_static/stsci_logo2.png"/>
       <h1 class="site-logo" id="site-title">
        STScI JDAT Notebooks
       </h1>
      </a>
     </div>
     <form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
      <i class="icon fas fa-search">
      </i>
      <input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
     </form>
     <nav aria-label="Main" class="bd-links" id="bd-docs-nav">
      <div class="bd-toc-item active">
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../../intro.html">
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         Cross-Instrument
        </span>
       </p>
       <ul class="current nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../asdf_example/asdf_example.html">
          Example of Converting a FITS File to ASDF
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../background_estimation_imaging/Imaging%20Sky%20Background%20Estimation.html">
          Complex 2D Background
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
          Draft: Advanced Composite spectral model fitting
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
          MAST Query
         </a>
        </li>
        <li class="toctree-l1 current active">
         <a class="current reference internal" href="#">
          Specviz Simple Demo
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         MIRI
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html">
          MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">
          Data Analysis
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
          JWST Data Analysis
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
          LRS Extraction
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRCam
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
          Point Source Aperture Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRCam_photometry/NIRCam%20multiband%20photometry.html">
          NIRCam Multiband Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
          PSF Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
          NIRCam PSF-matched multiband photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../preimaging/preimaging_02_calwebb.html">
          Preimaging - Calwebb
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../preimaging/preimaging_03_association.html">
          Creating simulated images of the JWST astrometric calibration field in the LMC
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRISS
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00.%20Optimal%20extraction.html">
          Part 0: Optimal Extraction of NIRISS WFSS Spectrum
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01.%20Combine%20and%20normalize%201D%20spectra.html">
          Part 1: Combine One-Dimensional NIRISS WFSS Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02.%20Cross%20correlation%20template.html">
          Part 2: Cross Correlation to Determine Redshift of NIRISS WFSS Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html">
          Part 3: Spatially Resolved Emission Line Map of NIRISS WFSS Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../niriss_ami_binary/1_niriss_ami_binary.html">
          NIRISS AMI simulation of binary point source AB Dor and calibrator HD37093
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../niriss_ami_binary/2_niriss_ami_binary.html">
          AMI Binary Star Notebook 2
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../soss-transit-spectroscopy/HAT-P-1b-PART3-data-analysis.html">
          SOSS Transient Spectroscopy
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRSpec
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
          MOS Optimal Extraction
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
          MOS Spectroscopy of Extragalactic Field
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
          Extracting an Exoplanet Transmission Spectrum from NIRSpec BOTS Time Series Observations
         </a>
        </li>
       </ul>
      </div>
     </nav>
     <!-- To handle the deprecated key -->
     <div class="navbar_extra_footer">
      Powered by
      <a href="https://jupyterbook.org">
       Jupyter Book
      </a>
     </div>
    </div>
    <main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
     <div class="topbar container-xl fixed-top">
      <div class="topbar-contents row">
       <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
       </div>
       <div class="col pl-md-4 topbar-main">
        <button aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" class="navbar-toggler ml-0" data-placement="bottom" data-target=".site-navigation" data-toggle="collapse" id="navbar-toggler" title="Toggle navigation" type="button">
         <i class="fas fa-bars">
         </i>
         <i class="fas fa-arrow-left">
         </i>
         <i class="fas fa-arrow-up">
         </i>
        </button>
        <div class="dropdown-buttons-trigger">
         <button aria-label="Download this page" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fas fa-download">
          </i>
         </button>
         <div class="dropdown-buttons">
          <!-- ipynb file if we had a myst markdown file -->
          <!-- Download raw file -->
          <a class="dropdown-buttons" href="../../_sources/notebooks/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.ipynb">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Download source file" type="button">
            .ipynb
           </button>
          </a>
          <!-- Download PDF via print -->
          <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" id="download-print" onclick="printPdf(this)" title="Print to PDF" type="button">
           .pdf
          </button>
         </div>
        </div>
        <!-- Source interaction buttons -->
        <div class="dropdown-buttons-trigger">
         <button aria-label="Connect with source repository" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fab fa-github">
          </i>
         </button>
         <div class="dropdown-buttons sourcebuttons">
          <a class="repository-button" href="https://github.com/spacetelescope/jdat_notebooks/">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Source repository" type="button">
            <i class="fab fa-github">
            </i>
            repository
           </button>
          </a>
          <a class="issues-button" href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html&amp;body=Your%20issue%20content%20here.">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Open an issue" type="button">
            <i class="fas fa-lightbulb">
            </i>
            open issue
           </button>
          </a>
         </div>
        </div>
        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button">
         <button aria-label="Fullscreen mode" class="btn btn-secondary topbarbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode" type="button">
          <i class="fas fa-expand">
          </i>
         </button>
        </a>
        <!-- Launch buttons -->
        <div class="dropdown-buttons-trigger">
         <button aria-label="Launch interactive content" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fas fa-rocket">
          </i>
         </button>
         <div class="dropdown-buttons">
          <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" onclick="initThebeSBT()" title="Launch Thebe" type="button">
           <i class="fas fa-play">
           </i>
           <span style="margin-left: .4em;">
            Live Code
           </span>
          </button>
         </div>
        </div>
       </div>
       <!-- Table of contents -->
       <div class="d-none d-md-block col-md-2 bd-toc show noprint">
        <div class="tocsection onthispage pt-5 pb-3">
         <i class="fas fa-list">
         </i>
         Contents
        </div>
        <nav aria-label="Page" id="bd-toc-nav">
         <ul class="visible nav section-nav flex-column">
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#load-niriss-pipeline-output">
            1. Load NIRISS pipeline output
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#open-specviz-and-load-all-the-1d-spectra">
            2. Open Specviz and load all the 1D spectra
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#select-the-emission-lines-using-the-gui-and-in-the-notebook">
            3. Select the emission lines using the GUI and in the notebook
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#see-what-data-is-used-in-this-specviz-istance">
              See what data is used in this specviz istance
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#see-the-subsets-defined-in-the-gui">
              See the subsets defined in the GUI
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#select-the-same-region-programmatically">
              Select the same region programmatically
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#plot-the-spectrum-and-the-subset-with-matplotlib">
              Plot the spectrum and the subset with matplotlib
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#use-the-redshift-slider-in-specviz-to-find-the-redshift">
            4. Use the redshift slider in Specviz to find the redshift
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#get-the-redshift-out-in-the-spectrum1d-object">
              Get the redshift out in the Spectrum1D object
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#model-the-continuum-of-the-spectrum">
            5. Model the continuum of the spectrum
           </a>
          </li>
         </ul>
        </nav>
       </div>
      </div>
     </div>
     <div class="row" id="main-content">
      <div class="col-12 col-md-9 pl-md-3 pr-md-0">
       <!-- Table of contents that is only displayed when printing the page -->
       <div class="onlyprint" id="jb-print-docs-body">
        <h1>
         Specviz notebook/GUI interaction on NIRISS WFSS 1D spectra
        </h1>
        <!-- Table of contents -->
        <div id="print-main-content">
         <div id="jb-print-toc">
          <div>
           <h2>
            Contents
           </h2>
          </div>
          <nav aria-label="Page">
           <ul class="visible nav section-nav flex-column">
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#load-niriss-pipeline-output">
              1. Load NIRISS pipeline output
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#open-specviz-and-load-all-the-1d-spectra">
              2. Open Specviz and load all the 1D spectra
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#select-the-emission-lines-using-the-gui-and-in-the-notebook">
              3. Select the emission lines using the GUI and in the notebook
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#see-what-data-is-used-in-this-specviz-istance">
                See what data is used in this specviz istance
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#see-the-subsets-defined-in-the-gui">
                See the subsets defined in the GUI
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#select-the-same-region-programmatically">
                Select the same region programmatically
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#plot-the-spectrum-and-the-subset-with-matplotlib">
                Plot the spectrum and the subset with matplotlib
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#use-the-redshift-slider-in-specviz-to-find-the-redshift">
              4. Use the redshift slider in Specviz to find the redshift
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#get-the-redshift-out-in-the-spectrum1d-object">
                Get the redshift out in the Spectrum1D object
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#model-the-continuum-of-the-spectrum">
              5. Model the continuum of the spectrum
             </a>
            </li>
           </ul>
          </nav>
         </div>
        </div>
       </div>
       <div>
        <div class="tex2jax_ignore mathjax_ignore section" id="specviz-notebook-gui-interaction-on-niriss-wfss-1d-spectra">
         <h1>
          Specviz notebook/GUI interaction on NIRISS WFSS 1D spectra
          <a class="headerlink" href="#specviz-notebook-gui-interaction-on-niriss-wfss-1d-spectra" title="Permalink to this headline">
           ¶
          </a>
         </h1>
         <p>
          This notebook demonstrates how to inspect spectra in Specviz, export spectra from the GUI in the notebook, select regions in the GUI and in the notebook, and measure the redshift of a source in the GUI. The dataset is a JWST/NIRISS simulation of a generic scene with extended sources generated with the code MIRAGE (
          <a class="reference external" href="https://mirage-data-simulator.readthedocs.io/en/latest/">
           https://mirage-data-simulator.readthedocs.io/en/latest/
          </a>
          ) and run through the JWST calibration pipeline (
          <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/">
           https://jwst-pipeline.readthedocs.io/en/latest/
          </a>
          ).
         </p>
         <p>
          Installation instructions to include the latest version of specutils, the visualization tools (jdaviz), and implicitly Jupyter:
         </p>
         <ul class="simple">
          <li>
           <p>
            Create a fresh conda environment with python (conda create -n env_name python)
           </p>
          </li>
          <li>
           <p>
            Activate environment (conda activate env_name)
           </p>
          </li>
          <li>
           <p>
            Install latest specutils and jdaviz:
           </p>
           <ul>
            <li>
             <p>
              pip install git+https://github.com/astropy/specutils.git
             </p>
            </li>
            <li>
             <p>
              pip install git+https://github.com/spacetelescope/jdaviz.git
             </p>
            </li>
           </ul>
          </li>
         </ul>
         <p>
          <strong>
           Author
          </strong>
          : Camilla Pacifici, NIRISS Instrument Scientist
         </p>
         <p>
          <strong>
           Updated on
          </strong>
          : 2021/3/4
         </p>
         <div class="cell docutils container">
          <div class="cell_input docutils container">
           <div class="highlight-ipython3 notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#to use 100% of the browser window</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">"&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"</span><span class="p">))</span>
</pre>
            </div>
           </div>
          </div>
         </div>
         <p>
          Imports:
         </p>
         <ul class="simple">
          <li>
           <p>
            matplotlib for plotting data
           </p>
          </li>
          <li>
           <p>
            astropy for handling of fits files, units, and tables
           </p>
          </li>
          <li>
           <p>
            specutils for interactions with Specviz and region definition/extraction
           </p>
          </li>
          <li>
           <p>
            jdaviz for the visualization tool Specviz
           </p>
          </li>
         </ul>
         <div class="cell docutils container">
          <div class="cell_input docutils container">
           <div class="highlight-ipython3 notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#plotting and tabling</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#import astropy</span>
<span class="kn">import</span> <span class="nn">astropy</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">StdDevUncertainty</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">QTable</span>

<span class="c1">#import specutils</span>
<span class="kn">import</span> <span class="nn">specutils</span>
<span class="kn">from</span> <span class="nn">specutils</span> <span class="kn">import</span> <span class="n">Spectrum1D</span><span class="p">,</span> <span class="n">SpectralRegion</span>
<span class="kn">from</span> <span class="nn">specutils.manipulation</span> <span class="kn">import</span> <span class="n">extract_region</span>

<span class="c1">#import viztools</span>
<span class="kn">import</span> <span class="nn">jdaviz</span>
<span class="kn">from</span> <span class="nn">jdaviz</span> <span class="kn">import</span> <span class="n">SpecViz</span>
</pre>
            </div>
           </div>
          </div>
         </div>
         <div class="cell docutils container">
          <div class="cell_input docutils container">
           <div class="highlight-ipython3 notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#customization of matplotlib style</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">'legend.fontsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span><span class="s1">'axes.labelsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span>
        <span class="s1">'axes.titlesize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span><span class="s1">'xtick.labelsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span>
        <span class="s1">'ytick.labelsize'</span><span class="p">:</span><span class="s1">'18'</span><span class="p">,</span><span class="s1">'lines.linewidth'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s1">'axes.linewidth'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">'animation.html'</span><span class="p">:</span> <span class="s1">'html5'</span><span class="p">,</span>
        <span class="s1">'figure.figsize'</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'figure.max_open_warning'</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
</pre>
            </div>
           </div>
          </div>
         </div>
         <p>
          Check versions
         </p>
         <div class="cell docutils container">
          <div class="cell_input docutils container">
           <div class="highlight-ipython3 notranslate">
            <div class="highlight">
             <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'astropy:'</span><span class="p">,</span><span class="n">astropy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'specutils:'</span><span class="p">,</span><span class="n">specutils</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'jdaviz:'</span><span class="p">,</span><span class="n">jdaviz</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="load-niriss-pipeline-output">
          <h2>
           1. Load NIRISS pipeline output
           <a class="headerlink" href="#load-niriss-pipeline-output" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           The JWST/NIRISS simulation is stored on box. We work with the x1d file which contains all extracted 1D spectra.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">filelink</span> <span class="o">=</span> <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/specviz_notebook_gui_interaction/basic_F150W_WFSSR_dit1_x1d.fits'</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filelink</span><span class="p">)</span>

<span class="n">hdu</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="open-specviz-and-load-all-the-1d-spectra">
          <h2>
           2. Open Specviz and load all the 1D spectra
           <a class="headerlink" href="#open-specviz-and-load-all-the-1d-spectra" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Parsers are not ready for all instruments, so we load the spectrum manually and we write in a Spectrum1D.
          </p>
          <p>
           <strong>
            Developer note:
           </strong>
          </p>
          <p>
           We need a parser for NIRISS WFSS x1d.fits files.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">viz</span> <span class="o">=</span> <span class="n">SpecViz</span><span class="p">()</span>
<span class="n">viz</span><span class="o">.</span><span class="n">app</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           The following cell opens one-by-one the extensions of the x1d file, creates Spectrum1D objects for all the spectra, and loads them into Specviz. A mask is set to only keep the part of the spectra with good sensitivity (1.34 to 1.66 micron) in the F150W filter. The for loop runs from 2 to 19, because spectra 0 and 1 have very short extraction boxes and are not useful for this work (this can be seen in the dimentions of the extensions of the fits file). The spectra are also inverted. The pipeline extracts them in reverse wavelength order because the dispersion direction is from right to left on the detector.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">19</span><span class="p">):</span>
    <span class="n">spec_load</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

    <span class="c1">#invert axis</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">spec_load</span><span class="p">[</span><span class="s1">'WAVELENGTH'</span><span class="p">]</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">spec_load</span><span class="p">[</span><span class="s1">'FLUX'</span><span class="p">]</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">spec_load</span><span class="p">[</span><span class="s1">'ERROR'</span><span class="p">]</span>
    <span class="n">invwave</span> <span class="o">=</span> <span class="n">wave</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">invflux</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">inverror</span> <span class="o">=</span> <span class="n">error</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#mask the parts where the sensitivity in the bandpass is poor</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">invwave</span><span class="o">&gt;</span><span class="mf">1.34</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">invwave</span><span class="o">&lt;</span><span class="mf">1.66</span><span class="p">))</span>

    <span class="n">spec1d</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">invwave</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> 
                    <span class="n">flux</span><span class="o">=</span><span class="n">invflux</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">,</span> 
                    <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">(</span><span class="n">inverror</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">))</span> <span class="c1">#</span>
    
    <span class="n">viz</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">spec1d</span><span class="p">,</span><span class="s2">"NIRISS 1D </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>

    <span class="c1">#print(spec1d)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           This is just for quick look to see all the spectra that are in the file. We can go to the hammer and screwdriver icon, then the gear icon and select/deselect the spectra. We find our favorite spectrum (NIRISS ID 6) and work with that.
          </p>
         </div>
         <div class="section" id="select-the-emission-lines-using-the-gui-and-in-the-notebook">
          <h2>
           3. Select the emission lines using the GUI and in the notebook
           <a class="headerlink" href="#select-the-emission-lines-using-the-gui-and-in-the-notebook" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           I open the hammer and screwdriver menu and click the “Select range of x values” icon. Then I select the region spanning the emission lines from roughly 1.35 to 1.43 microns.
          </p>
          <p>
           Instructions:
           <a class="reference external" href="https://jdaviz.readthedocs.io/en/latest/specviz/displaying.html#defining-spectral-regions">
            https://jdaviz.readthedocs.io/en/latest/specviz/displaying.html#defining-spectral-regions
           </a>
          </p>
          <p>
           <img alt="Screen%20Shot%202021-01-15%20at%202.29.57%20PM.png" src="notebooks/specviz_notebookGUI_interaction/attachment:Screen%20Shot%202021-01-15%20at%202.29.57%20PM.png"/>
          </p>
          <div class="section" id="see-what-data-is-used-in-this-specviz-istance">
           <h3>
            See what data is used in this specviz istance
            <a class="headerlink" href="#see-what-data-is-used-in-this-specviz-istance" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">dataout</span> <span class="o">=</span> <span class="n">viz</span><span class="o">.</span><span class="n">get_spectra</span><span class="p">()</span>
<span class="n">spec1d_line</span> <span class="o">=</span> <span class="n">dataout</span><span class="p">[</span><span class="s2">"NIRISS 1D 6"</span><span class="p">]</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">spec1d_line</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="see-the-subsets-defined-in-the-gui">
           <h3>
            See the subsets defined in the GUI
            <a class="headerlink" href="#see-the-subsets-defined-in-the-gui" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            I include a try-except in case the notebook is run without human interaction.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">viz</span><span class="o">.</span><span class="n">get_spectral_regions</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="s1">'Subset 1'</span><span class="p">])</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"No region defined in the GUI"</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="select-the-same-region-programmatically">
           <h3>
            Select the same region programmatically
            <a class="headerlink" href="#select-the-same-region-programmatically" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            I can define my own region (cont_region) between arbitrary bounds. I choose 1.35um and 1.42um. I can then extract the spectrum in that region.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">cont_region</span> <span class="o">=</span> <span class="n">SpectralRegion</span><span class="p">(</span><span class="mf">1.35</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span><span class="mf">1.42</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
<span class="n">spec1d_el_code</span> <span class="o">=</span> <span class="n">extract_region</span><span class="p">(</span><span class="n">spec1d_line</span><span class="p">,</span> <span class="n">cont_region</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spec1d_el_code</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <p>
            Or I can extract the spectrum in the region I defined in the GUI (region[‘Subset 1’]).
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">spec1d_el_viz</span> <span class="o">=</span> <span class="n">extract_region</span><span class="p">(</span><span class="n">spec1d_line</span><span class="p">,</span> <span class="n">region</span><span class="p">[</span><span class="s1">'Subset 1'</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">spec1d_el_viz</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Region was not defined in the GUI"</span><span class="p">)</span>
    <span class="c1">#define spec1d_el_viz as spec1d_el_code</span>
    <span class="n">spec1d_el_viz</span> <span class="o">=</span> <span class="n">spec1d_el_code</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="plot-the-spectrum-and-the-subset-with-matplotlib">
           <h3>
            Plot the spectrum and the subset with matplotlib
            <a class="headerlink" href="#plot-the-spectrum-and-the-subset-with-matplotlib" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_line</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_line</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d_el_viz</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spec1d_el_viz</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_line</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec1d_line</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"NIRISS ID 6"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="use-the-redshift-slider-in-specviz-to-find-the-redshift">
          <h2>
           4. Use the redshift slider in Specviz to find the redshift
           <a class="headerlink" href="#use-the-redshift-slider-in-specviz-to-find-the-redshift" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           I start by opening a new instance of Specviz so that I do not have to scroll up and down too much.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">viz2</span> <span class="o">=</span> <span class="n">SpecViz</span><span class="p">()</span>
<span class="n">viz2</span><span class="o">.</span><span class="n">app</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           I load just the interesting spectrum (spec1d_line).
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">viz2</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">spec1d_line</span><span class="p">,</span><span class="s2">"NIRISS 1D lines"</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           I can use an available line lists or define my own lines (I know I need Hb4861.3 and the [OIII]4958.9,5006.8 doublet) and play with the redshift slider to match the lines in the line list with the lines in the spectrum. The line list plugin can be found clicking the Lego icon on the upper right of the viewer. To input just the three lines, I can use the “Custom” menu.
          </p>
          <p>
           Here is the documentation where line lists are explained:
           <a class="reference external" href="https://jdaviz.readthedocs.io/en/latest/specviz/plugins.html#line-lists">
            https://jdaviz.readthedocs.io/en/latest/specviz/plugins.html#line-lists
           </a>
          </p>
          <p>
           I can also define the lines of interest programmatically, as shown in the following cell.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">lt</span> <span class="o">=</span> <span class="n">QTable</span><span class="p">()</span>
<span class="n">lt</span><span class="p">[</span><span class="s1">'linename'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Hb'</span><span class="p">,</span><span class="s1">'[OIII]1'</span><span class="p">,</span><span class="s1">'[OIII]2'</span><span class="p">]</span>
<span class="n">lt</span><span class="p">[</span><span class="s1">'rest'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4861.3</span><span class="p">,</span><span class="mf">4958.9</span><span class="p">,</span><span class="mf">5006.8</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span>

<span class="n">viz2</span><span class="o">.</span><span class="n">load_line_list</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           The lines are not showing now because their rest value is outside the range plotted here. I can move the lines using the redshift slider at the top. It is best to first set the redshift to 2 in the box with the number and then move the slider to bring the lines on top of the observed emission lines.
          </p>
          <div class="section" id="get-the-redshift-out-in-the-spectrum1d-object">
           <h3>
            Get the redshift out in the Spectrum1D object
            <a class="headerlink" href="#get-the-redshift-out-in-the-spectrum1d-object" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">spec1d_redshift</span> <span class="o">=</span> <span class="n">viz2</span><span class="o">.</span><span class="n">get_spectra</span><span class="p">()[</span><span class="s2">"NIRISS 1D lines"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spec1d_redshift</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>

<span class="k">if</span> <span class="n">spec1d_redshift</span><span class="o">.</span><span class="n">redshift</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"NIRISS 1D lines redshift="</span><span class="p">,</span><span class="n">spec1d_redshift</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Redshift was not defined in GUI. Defining it here."</span><span class="p">)</span>
    <span class="n">spec1d_redshift</span><span class="o">.</span><span class="n">redshift</span> <span class="o">=</span> <span class="mf">1.798</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"NIRISS 1D lines redshift="</span><span class="p">,</span><span class="n">spec1d_redshift</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="model-the-continuum-of-the-spectrum">
          <h2>
           5. Model the continuum of the spectrum
           <a class="headerlink" href="#model-the-continuum-of-the-spectrum" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           I open another instance of Specviz and load the same specrum used before.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">viz3</span> <span class="o">=</span> <span class="n">SpecViz</span><span class="p">()</span>
<span class="n">viz3</span><span class="o">.</span><span class="n">app</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">viz3</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">spec1d_line</span><span class="p">,</span><span class="s2">"NIRISS 1D lines"</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           I can use the GUI to select the region where I see the continuum. This is between 1.45 and 1.63 microns roughly. To do so, I go to the hammer and screwdriver icon and use the Select Region button.
          </p>
          <p>
           I can then use the Model Fitting plugin under the Lego icon to fit a linear model to the selected region. Instructions can be found here:
           <a class="reference external" href="https://jdaviz.readthedocs.io/en/latest/specviz/plugins.html#model-fitting">
            https://jdaviz.readthedocs.io/en/latest/specviz/plugins.html#model-fitting
           </a>
           . The individual steps to complete this task are:
          </p>
          <ul class="simple">
           <li>
            <p>
             Select Subset 1 under Data
            </p>
           </li>
           <li>
            <p>
             Select Linear1D under Model
            </p>
           </li>
           <li>
            <p>
             Enter a model ID under Model ID (I use “lin”)
            </p>
           </li>
           <li>
            <p>
             Click Add model
            </p>
           </li>
           <li>
            <p>
             Enter the needed combination of models under Model Equation Editor (it is just one model here, so I enter just “lin”)
            </p>
           </li>
           <li>
            <p>
             Enter a name for the model under Model Label (I choose “continuum”)
            </p>
           </li>
           <li>
            <p>
             Click Fit
            </p>
           </li>
           <li>
            <p>
             Click Add to viewer
            </p>
           </li>
           <li>
            <p>
             Go to the hammer and screwdiver icon, then gear icon, and select the new dataset “continuum”.
            </p>
           </li>
          </ul>
          <p>
           I can extract the model from the datasets in use.
          </p>
          <p>
           <strong>
            Developer Note:
           </strong>
          </p>
          <p>
           I would like to be able to extract also the model parameters, not just the model spectrum. This is being worked on.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">dataout3</span> <span class="o">=</span> <span class="n">viz3</span><span class="o">.</span><span class="n">get_spectra</span><span class="p">()</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">dataout3</span><span class="p">[</span><span class="s2">"NIRISS 1D lines"</span><span class="p">]</span> <span class="c1">#this is exactly the same as the spec1d_lines loaded a few cells above</span>
    <span class="n">continuum</span> <span class="o">=</span> <span class="n">dataout3</span><span class="p">[</span><span class="s2">"continuum"</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Continuum has not been created. Setting it to 0"</span><span class="p">)</span>
    <span class="n">continuum</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span> <span class="mf">0.</span><span class="o">*</span><span class="n">spectrum</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <p>
           I can do a continuum subtraction and plot the result with matplotlib. If the continuum has not been defined in the GUI, this operation returns the original spectrum unchanged.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">spectrum_sub</span> <span class="o">=</span> <span class="n">spectrum</span> <span class="o">-</span> <span class="n">continuum</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectrum_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span><span class="n">spectrum_sub</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.3</span><span class="p">,</span><span class="mf">1.7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"wavelength ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spectrum_sub</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"flux ({:latex})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spectrum_sub</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"NIRISS ID 6"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="float: right;" width="200px"/>
         </div>
        </div>
        <script type="text/x-thebe-config">
         {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/specviz_notebookGUI_interaction"
        },
        predefinedOutput: true
    }
        </script>
        <script>
         kernelName = 'python3'
        </script>
       </div>
       <!-- Previous / next buttons -->
       <div class="prev-next-area">
        <a class="left-prev" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html" id="prev-link" title="previous page">
         <i class="fas fa-angle-left">
         </i>
         <div class="prev-next-info">
          <p class="prev-next-subtitle">
           previous
          </p>
          <p class="prev-next-title">
           MAST Query Tutorial for NIRSpec Users
          </p>
         </div>
        </a>
        <a class="right-next" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html" id="next-link" title="next page">
         <div class="prev-next-info">
          <p class="prev-next-subtitle">
           next
          </p>
          <p class="prev-next-title">
           MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline
          </p>
         </div>
         <i class="fas fa-angle-right">
         </i>
        </a>
       </div>
      </div>
     </div>
     <footer class="footer">
      <p>
       By STScI
       <br/>
       © Copyright 2022.
       <br/>
      </p>
     </footer>
    </main>
   </div>
  </div>
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js">
  </script>
 </body>
</html>
